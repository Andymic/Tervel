<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>Tervel: tervel::memory::rc::DescriptorPool Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tervel
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">A collection of non-blocking data structures and algorithms.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacetervel.html">tervel</a></li><li class="navelem"><a class="el" href="namespacetervel_1_1memory.html">memory</a></li><li class="navelem"><a class="el" href="namespacetervel_1_1memory_1_1rc.html">rc</a></li><li class="navelem"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html">DescriptorPool</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">tervel::memory::rc::DescriptorPool Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Defines a pool of descriptor objects which is used to allocate descriptors and to store them while they are not safe to delete.  
 <a href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="descriptor__pool_8h_source.html">descriptor_pool.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a77cad4dab41c3977c2ddc0e872b34025"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#a77cad4dab41c3977c2ddc0e872b34025">DescriptorPool</a> (int pool_id, <a class="el" href="classtervel_1_1memory_1_1rc_1_1_pool_manager.html">PoolManager</a> *manager, int prefill=4)</td></tr>
<tr class="separator:a77cad4dab41c3977c2ddc0e872b34025"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e43c5c21db028bf62a7a43d5533f1e5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#a7e43c5c21db028bf62a7a43d5533f1e5">~DescriptorPool</a> ()</td></tr>
<tr class="separator:a7e43c5c21db028bf62a7a43d5533f1e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75a19822fa75d106b251f361ef0bcf00"><td class="memTemplParams" colspan="2">template&lt;typename DescrType , typename... Args&gt; </td></tr>
<tr class="memitem:a75a19822fa75d106b251f361ef0bcf00"><td class="memTemplItemLeft" align="right" valign="top">Descriptor *&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#a75a19822fa75d106b251f361ef0bcf00">get_descriptor</a> (Args &amp;&amp;...args)</td></tr>
<tr class="memdesc:a75a19822fa75d106b251f361ef0bcf00"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructs and returns a descriptor.  <a href="#a75a19822fa75d106b251f361ef0bcf00">More...</a><br /></td></tr>
<tr class="separator:a75a19822fa75d106b251f361ef0bcf00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18909f7bc2535719f6c135cef478016f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#a18909f7bc2535719f6c135cef478016f">free_descriptor</a> (Descriptor *descr, bool dont_check=false)</td></tr>
<tr class="memdesc:a18909f7bc2535719f6c135cef478016f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Once a user is done with a descriptor, they should free it with this method.  <a href="#a18909f7bc2535719f6c135cef478016f">More...</a><br /></td></tr>
<tr class="separator:a18909f7bc2535719f6c135cef478016f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d6d8a6c3ebd8e18addff1a3f723d3e0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#a3d6d8a6c3ebd8e18addff1a3f723d3e0">reserve</a> (int num_descriptors)</td></tr>
<tr class="memdesc:a3d6d8a6c3ebd8e18addff1a3f723d3e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates an extra <code>num_descriptors</code> elements to the pool.  <a href="#a3d6d8a6c3ebd8e18addff1a3f723d3e0">More...</a><br /></td></tr>
<tr class="separator:a3d6d8a6c3ebd8e18addff1a3f723d3e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:aa3aa7d736d321e9b0ff9657446395655"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_pool_element.html">PoolElement</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#aa3aa7d736d321e9b0ff9657446395655">get_from_pool</a> (bool allocate_new=true)</td></tr>
<tr class="memdesc:aa3aa7d736d321e9b0ff9657446395655"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets a free element.  <a href="#aa3aa7d736d321e9b0ff9657446395655">More...</a><br /></td></tr>
<tr class="separator:aa3aa7d736d321e9b0ff9657446395655"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb45975645140b33d46973396f44820e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#acb45975645140b33d46973396f44820e">send_to_manager</a> ()</td></tr>
<tr class="memdesc:acb45975645140b33d46973396f44820e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends all elements managed by this pool to the parent pool.  <a href="#acb45975645140b33d46973396f44820e">More...</a><br /></td></tr>
<tr class="separator:acb45975645140b33d46973396f44820e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9cacd7d7bda27e9aedda1341a4b8df81"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#a9cacd7d7bda27e9aedda1341a4b8df81">send_safe_to_manager</a> ()</td></tr>
<tr class="memdesc:a9cacd7d7bda27e9aedda1341a4b8df81"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends the elements from the safe pool to the corresponding safe pool in this pool's manager.  <a href="#a9cacd7d7bda27e9aedda1341a4b8df81">More...</a><br /></td></tr>
<tr class="separator:a9cacd7d7bda27e9aedda1341a4b8df81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b69634634a1b037afd43f4f16727823"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#a1b69634634a1b037afd43f4f16727823">send_unsafe_to_manager</a> ()</td></tr>
<tr class="memdesc:a1b69634634a1b037afd43f4f16727823"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends the elements from the unsafe pool to the corresponding unsafe pool in this pool's manager.  <a href="#a1b69634634a1b037afd43f4f16727823">More...</a><br /></td></tr>
<tr class="separator:a1b69634634a1b037afd43f4f16727823"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81ca80c17adc40f9c6e0442a49598bbc"><td class="memItemLeft" align="right" valign="top">std::atomic&lt; <a class="el" href="classtervel_1_1memory_1_1rc_1_1_pool_element.html">PoolElement</a> * &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#a81ca80c17adc40f9c6e0442a49598bbc">manager_safe_pool</a> ()</td></tr>
<tr class="memdesc:a81ca80c17adc40f9c6e0442a49598bbc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the safe pool of the manager associated with this pool.  <a href="#a81ca80c17adc40f9c6e0442a49598bbc">More...</a><br /></td></tr>
<tr class="separator:a81ca80c17adc40f9c6e0442a49598bbc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf683720748c90ddb9d35889247fd174"><td class="memItemLeft" align="right" valign="top">std::atomic&lt; <a class="el" href="classtervel_1_1memory_1_1rc_1_1_pool_element.html">PoolElement</a> * &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#adf683720748c90ddb9d35889247fd174">manager_unsafe_pool</a> ()</td></tr>
<tr class="memdesc:adf683720748c90ddb9d35889247fd174"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the unsafe pool of the manager associated with this pool.  <a href="#adf683720748c90ddb9d35889247fd174">More...</a><br /></td></tr>
<tr class="separator:adf683720748c90ddb9d35889247fd174"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc7943acf515840cbbd9bc50c9fd7848"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#acc7943acf515840cbbd9bc50c9fd7848">add_to_safe</a> (Descriptor *descr)</td></tr>
<tr class="memdesc:acc7943acf515840cbbd9bc50c9fd7848"><td class="mdescLeft">&#160;</td><td class="mdescRight">Releases the descriptor back to the safe pool.  <a href="#acc7943acf515840cbbd9bc50c9fd7848">More...</a><br /></td></tr>
<tr class="separator:acc7943acf515840cbbd9bc50c9fd7848"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adffdaf2c2f5bc27a680f9d0b877872df"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#adffdaf2c2f5bc27a680f9d0b877872df">add_to_unsafe</a> (Descriptor *descr)</td></tr>
<tr class="memdesc:adffdaf2c2f5bc27a680f9d0b877872df"><td class="mdescLeft">&#160;</td><td class="mdescRight">Releases the descriptor back to the unsafe pool.  <a href="#adffdaf2c2f5bc27a680f9d0b877872df">More...</a><br /></td></tr>
<tr class="separator:adffdaf2c2f5bc27a680f9d0b877872df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad711d846f9aa222e01496ea7a56ab0b7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#ad711d846f9aa222e01496ea7a56ab0b7">try_clear_unsafe_pool</a> (bool dont_check=false)</td></tr>
<tr class="memdesc:ad711d846f9aa222e01496ea7a56ab0b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Try to move elements from the unsafe pool to the safe pool.  <a href="#ad711d846f9aa222e01496ea7a56ab0b7">More...</a><br /></td></tr>
<tr class="separator:ad711d846f9aa222e01496ea7a56ab0b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a3972485e0d1a5a9fa8a4720b7d059b4a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#a3972485e0d1a5a9fa8a4720b7d059b4a">pool_id_</a></td></tr>
<tr class="memdesc:a3972485e0d1a5a9fa8a4720b7d059b4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Index into this pool's manager's pool array corresponding to this pool.  <a href="#a3972485e0d1a5a9fa8a4720b7d059b4a">More...</a><br /></td></tr>
<tr class="separator:a3972485e0d1a5a9fa8a4720b7d059b4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a080cbc50d9d56449ca1469ec6fae62fb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_pool_manager.html">PoolManager</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#a080cbc50d9d56449ca1469ec6fae62fb">manager_</a></td></tr>
<tr class="memdesc:a080cbc50d9d56449ca1469ec6fae62fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">This pool's manager.  <a href="#a080cbc50d9d56449ca1469ec6fae62fb">More...</a><br /></td></tr>
<tr class="separator:a080cbc50d9d56449ca1469ec6fae62fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14bf9b954a32f8bcfa10d5dfeda49409"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_pool_element.html">PoolElement</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#a14bf9b954a32f8bcfa10d5dfeda49409">safe_pool_</a> {nullptr}</td></tr>
<tr class="memdesc:a14bf9b954a32f8bcfa10d5dfeda49409"><td class="mdescLeft">&#160;</td><td class="mdescRight">A linked list of pool elements.  <a href="#a14bf9b954a32f8bcfa10d5dfeda49409">More...</a><br /></td></tr>
<tr class="separator:a14bf9b954a32f8bcfa10d5dfeda49409"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7eabf5758301500e60f308f1206fb2d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_pool_element.html">PoolElement</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#ae7eabf5758301500e60f308f1206fb2d">unsafe_pool_</a> {nullptr}</td></tr>
<tr class="memdesc:ae7eabf5758301500e60f308f1206fb2d"><td class="mdescLeft">&#160;</td><td class="mdescRight">A linked list of pool elements.  <a href="#ae7eabf5758301500e60f308f1206fb2d">More...</a><br /></td></tr>
<tr class="separator:ae7eabf5758301500e60f308f1206fb2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ea9f5e59c69ece7c45bdacc93ae6bb5"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#a3ea9f5e59c69ece7c45bdacc93ae6bb5">safe_pool_count_</a> {0}</td></tr>
<tr class="memdesc:a3ea9f5e59c69ece7c45bdacc93ae6bb5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Two counters used to track the number of elements in the linked list.  <a href="#a3ea9f5e59c69ece7c45bdacc93ae6bb5">More...</a><br /></td></tr>
<tr class="separator:a3ea9f5e59c69ece7c45bdacc93ae6bb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1a9a6b72a53eae4ce753835b3d98d0c"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#ad1a9a6b72a53eae4ce753835b3d98d0c">unsafe_pool_count_</a> {0}</td></tr>
<tr class="separator:ad1a9a6b72a53eae4ce753835b3d98d0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28fbdf35797b435856341c2cd0bdf939"><td class="memItemLeft" align="right" valign="top">constexpr bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#a28fbdf35797b435856341c2cd0bdf939">NO_REUSE_MEM</a> = false</td></tr>
<tr class="memdesc:a28fbdf35797b435856341c2cd0bdf939"><td class="mdescLeft">&#160;</td><td class="mdescRight">If true, then <a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html" title="Defines a pool of descriptor objects which is used to allocate descriptors and to store them while th...">DescriptorPool</a> shouldn't reuse old pool elements when being asked, even if it's safe to fo so.  <a href="#a28fbdf35797b435856341c2cd0bdf939">More...</a><br /></td></tr>
<tr class="separator:a28fbdf35797b435856341c2cd0bdf939"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Defines a pool of descriptor objects which is used to allocate descriptors and to store them while they are not safe to delete. </p>
<p>The pool is represented as two linked lists of descriptors: one for safe elements and one for unsafe elements. The safe pool is known to only contain items owned by the thread owning the <a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html" title="Defines a pool of descriptor objects which is used to allocate descriptors and to store them while th...">DescriptorPool</a> object, and the unsafe pool contains items where other threads may still hold refrences to them.</p>
<p>Further, the pool object has a parent who is shared amongst other threads. When a pool is to be destroyed, it sends its remaining elements to the parent, relinquishing ownership of said elements. A top-level pool has a null parent. At the moment, it only makes sense to have a single top-level parent representing the central pool for all threads, and several local pools for each thread.</p>
<p>TODO(steven) Need to implement max list size, when it is reached, elements are sent to the manager list TODO(steven) Need to implement logic to attempt to get elements from manager </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a77cad4dab41c3977c2ddc0e872b34025"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">tervel::memory::rc::DescriptorPool::DescriptorPool </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pool_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_pool_manager.html">PoolManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>prefill</em> = <code>4</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a7e43c5c21db028bf62a7a43d5533f1e5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">tervel::memory::rc::DescriptorPool::~DescriptorPool </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="acc7943acf515840cbbd9bc50c9fd7848"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void tervel::memory::rc::DescriptorPool::add_to_safe </td>
          <td>(</td>
          <td class="paramtype">Descriptor *&#160;</td>
          <td class="paramname"><em>descr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Releases the descriptor back to the safe pool. </p>
<p>Caller relinquishes ownership of descriptor. It's expected that the given descriptor was taken from this pool to begin with.</p>
<p>Adding a descriptor to the safe pool calls its 'on_return_to_pool' method and its destructor. </p>

</div>
</div>
<a class="anchor" id="adffdaf2c2f5bc27a680f9d0b877872df"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void tervel::memory::rc::DescriptorPool::add_to_unsafe </td>
          <td>(</td>
          <td class="paramtype">Descriptor *&#160;</td>
          <td class="paramname"><em>descr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Releases the descriptor back to the unsafe pool. </p>
<p>Caller relinquishes ownership of descriptor. It's expected that the given descriptor was taken from this pool to begin with.</p>
<p>See notes on <a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#acc7943acf515840cbbd9bc50c9fd7848" title="Releases the descriptor back to the safe pool. ">add_to_safe()</a> </p>

</div>
</div>
<a class="anchor" id="a18909f7bc2535719f6c135cef478016f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tervel::memory::rc::DescriptorPool::free_descriptor </td>
          <td>(</td>
          <td class="paramtype">Descriptor *&#160;</td>
          <td class="paramname"><em>descr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>dont_check</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Once a user is done with a descriptor, they should free it with this method. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">descr</td><td>The descriptor to free. </td></tr>
    <tr><td class="paramname">dont_check</td><td>Don't check if the descriptor is being watched before freeing it. Use this flag if you know that no other thread has had access to this descriptor. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a75a19822fa75d106b251f361ef0bcf00"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename DescrType , typename... Args&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">Descriptor * tervel::memory::rc::DescriptorPool::get_descriptor </td>
          <td>(</td>
          <td class="paramtype">Args &amp;&amp;...&#160;</td>
          <td class="paramname"><em>args</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructs and returns a descriptor. </p>
<p>Arguments are forwarded to the constructor of the given descriptor type. User should call free_descriptor on the returned pointer when they are done with it to avoid memory leaks. </p>

</div>
</div>
<a class="anchor" id="aa3aa7d736d321e9b0ff9657446395655"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_pool_element.html">PoolElement</a> * tervel::memory::rc::DescriptorPool::get_from_pool </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>allocate_new</em> = <code>true</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets a free element. </p>
<p>The local pool is checked for one first, then the manager if there are no local ones, and if all else fails, a new one is allocated using new.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">allocate_new</td><td>If true and there are no free elements to retrieve from the pool, a new one is allocated. Otherwise, nullptr is returned. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a81ca80c17adc40f9c6e0442a49598bbc"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic&lt;<a class="el" href="classtervel_1_1memory_1_1rc_1_1_pool_element.html">PoolElement</a> *&gt;&amp; tervel::memory::rc::DescriptorPool::manager_safe_pool </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets the safe pool of the manager associated with this pool. </p>

</div>
</div>
<a class="anchor" id="adf683720748c90ddb9d35889247fd174"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic&lt;<a class="el" href="classtervel_1_1memory_1_1rc_1_1_pool_element.html">PoolElement</a> *&gt;&amp; tervel::memory::rc::DescriptorPool::manager_unsafe_pool </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets the unsafe pool of the manager associated with this pool. </p>

</div>
</div>
<a class="anchor" id="a3d6d8a6c3ebd8e18addff1a3f723d3e0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tervel::memory::rc::DescriptorPool::reserve </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num_descriptors</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocates an extra <code>num_descriptors</code> elements to the pool. </p>

</div>
</div>
<a class="anchor" id="a9cacd7d7bda27e9aedda1341a4b8df81"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void tervel::memory::rc::DescriptorPool::send_safe_to_manager </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sends the elements from the safe pool to the corresponding safe pool in this pool's manager. </p>

</div>
</div>
<a class="anchor" id="acb45975645140b33d46973396f44820e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void tervel::memory::rc::DescriptorPool::send_to_manager </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sends all elements managed by this pool to the parent pool. </p>
<p>Same as: <a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#a9cacd7d7bda27e9aedda1341a4b8df81" title="Sends the elements from the safe pool to the corresponding safe pool in this pool&#39;s manager...">send_safe_to_manager()</a>; <a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html#a1b69634634a1b037afd43f4f16727823" title="Sends the elements from the unsafe pool to the corresponding unsafe pool in this pool&#39;s manager...">send_unsafe_to_manager()</a>; </p>

</div>
</div>
<a class="anchor" id="a1b69634634a1b037afd43f4f16727823"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void tervel::memory::rc::DescriptorPool::send_unsafe_to_manager </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sends the elements from the unsafe pool to the corresponding unsafe pool in this pool's manager. </p>

</div>
</div>
<a class="anchor" id="ad711d846f9aa222e01496ea7a56ab0b7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void tervel::memory::rc::DescriptorPool::try_clear_unsafe_pool </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>dont_check</em> = <code>false</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Try to move elements from the unsafe pool to the safe pool. </p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a080cbc50d9d56449ca1469ec6fae62fb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_pool_manager.html">PoolManager</a>* tervel::memory::rc::DescriptorPool::manager_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This pool's manager. </p>

</div>
</div>
<a class="anchor" id="a28fbdf35797b435856341c2cd0bdf939"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr bool tervel::memory::rc::DescriptorPool::NO_REUSE_MEM = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>If true, then <a class="el" href="classtervel_1_1memory_1_1rc_1_1_descriptor_pool.html" title="Defines a pool of descriptor objects which is used to allocate descriptors and to store them while th...">DescriptorPool</a> shouldn't reuse old pool elements when being asked, even if it's safe to fo so. </p>
<p>Instead, elements should be stock-piled and left untouched when they're returned to the pool. This allows the user to view associations. Entirely for debug purposes. </p>

</div>
</div>
<a class="anchor" id="a3972485e0d1a5a9fa8a4720b7d059b4a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int tervel::memory::rc::DescriptorPool::pool_id_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Index into this pool's manager's pool array corresponding to this pool. </p>

</div>
</div>
<a class="anchor" id="a14bf9b954a32f8bcfa10d5dfeda49409"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_pool_element.html">PoolElement</a>* tervel::memory::rc::DescriptorPool::safe_pool_ {nullptr}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A linked list of pool elements. </p>
<p>One can be assured that no thread will try to access the descriptor of any element in this pool. They can't be freed as some threads may still have access to the element itself and may try to increment the refrence count. </p>

</div>
</div>
<a class="anchor" id="a3ea9f5e59c69ece7c45bdacc93ae6bb5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t tervel::memory::rc::DescriptorPool::safe_pool_count_ {0}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Two counters used to track the number of elements in the linked list. </p>
<p>this facilitates the detection of when there are too many elements. </p>

</div>
</div>
<a class="anchor" id="ae7eabf5758301500e60f308f1206fb2d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtervel_1_1memory_1_1rc_1_1_pool_element.html">PoolElement</a>* tervel::memory::rc::DescriptorPool::unsafe_pool_ {nullptr}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A linked list of pool elements. </p>
<p>Elements get released to this pool when they're no longer needed, but some threads may still try to access the descriptor in the element. After some time has passed, items generally move from this pool to the safe_pool_ </p>

</div>
</div>
<a class="anchor" id="ad1a9a6b72a53eae4ce753835b3d98d0c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t tervel::memory::rc::DescriptorPool::unsafe_pool_count_ {0}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>tervel/memory/rc/<a class="el" href="descriptor__pool_8h_source.html">descriptor_pool.h</a></li>
<li>tervel/memory/rc/<a class="el" href="descriptor__pool_8cc.html">descriptor_pool.cc</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Apr 25 2014 13:17:00 for Tervel by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
